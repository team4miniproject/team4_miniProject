<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>헬스장</title>
    <!-- 구글폰트 시작코드 -->
    <link
      href="https://fonts.googleapis.com/css2?family=Nanum+Brush+Script&display=swap"
      rel="stylesheet"
    />
    <!-- 폰트어썸 시작코드 -->
    <script
      src="https://kit.fontawesome.com/06632c157c.js"
      crossorigin="anonymous"
    ></script>
    <!-- 부트스트랩 시작코드 -->
    <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
            rel="stylesheet"
            integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65"
            crossorigin="anonymous"
    />
    <!-- 제이쿼리 에이잭스  -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="//code.jquery.com/jquery-1.12.4.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.js"></script>

    ></script>

    <style>
      .topbar {
        width: auto;
        height: 70px;
        display: flex;
      }
      .topbar_title {
        flex-basis: 50%;
        text-align: center;
      }
      .topbar_category {
        flex-basis: 50%;
        /* line-height: 70px; */
      }
      .description {
        display: flex;
      }

      .description_left {
        flex-basis: 50%;
        margin: 0px 20px 20px 20px;
        
      }

      .description_left_map {
        background-color: brown;
        height: 400px;
        /* 박스내에서 텍스트 작성, 스크롤 */
        box-sizing: border-box;
        background: yellow;
        
        padding: 10px;
        overflow: auto;
        
      

      }
      .description_left_comment{
        margin-top: 20px;
      }


      .description_right {
        flex-basis: 50%;
        margin: 0px 20px 20px 20px;
        box-sizing: border-box;
        background: yellow;
        height: 500px;
        
        padding: 10px;
        overflow: auto;
      }

      .description_right_comment {
        border: 1px solid black;
        margin: 0px 0 10px 0;
        
      }
      .col{
        margin: 20px 0 20px 0px;
      }
    </style>

    <script>
      // ###################################################################################################################메인페이지가 열리면 자신의위치 주위의 헬스장목록을 보여줌..
      $(document).ready(function () {
        show_main();
      });
      function show_main() {
        // $('#cards-box').empty();
        $.ajax({
          type: 'GET',
          url: '/gyms',
          data: {},
          success: function (response) {
            let rows = response['gymsList'];
            for (let i = 0; i < rows.length; i++) {
              let title = rows[i]['gym_Title'];
              let desc = rows[i]['gym_Desc'];
              let location = rows[i]['gym_Location'];
              let phoneNumber = rows[i]['gym_PhoneNumber'];
              //헬스장이름, 영업시간, 위치, 전화번호= 정보를 받아옴..
              let temp_html = `<div class="col" >
                                <div OnClick=" select_comment('${title}')" style="cursor:pointer;" class="card h-100">
                                    
                                    <div class="card-body" style="background-color: var(--bg-color);">
                                        <h5 class="card-title">${title}</h5>
                                        <span class="card-text">${location}</span>
                                        <span class="card-text">-${desc}</span>
                                        <p class="card-text">${phoneNumber}</p>
                                    </div>
                                </div>
                             </div>`;
              $('#cards-box').append(temp_html);
            }
          },
        });
      }
// ################################################################################################################### 로그아웃기능 - 토큰값 지워버리고, 로그인창으로 돌아갈수있도록
      function logout(){
        $.removeCookie('mytoken');
        alert('로그아웃!')
        window.location.href='/'
      }

      
// ###################################################################################################################코멘트등록
      function select_comment(a) {
        // FIXME:로그인시 닉네임 id값    
            let nick = `{{nickname}}`
            let comment = $('#comment').val()
            let title = a
              console.log(title)

            $.ajax({
                type: 'POST',
                url: '/comment',
                data: {title_give:title,comment_give:comment,nick_give:nick},
                success: function (response) {
                    alert(response['msg'])
                    window.location.reload()


                }
            })
        }




      // gym박스 클릭시 코멘트를 보여주는 기능
      $(document).ready(function () {
        show_comment();
      });

      function show_comment() {
            $.ajax({
                type: "GET",
                url: "/comment",
                data: {},
                success: function (response) {
                    let rows = response['gymCommentList']
                    for (let i=0; i < rows.length; i++ ){
                        let title = rows[i]['title']
                        let comment = rows[i]['comment']
                        let nickname = rows[i]['nick']
                        // 해당 코멘트박스의 title(헬스장이름), 코멘트, 현재로그인중인 닉네임 값을 받아옴

                        let temp_html = `<div class="card-body">
                                            <blockquote class="blockquote mb-0">
                                                <p>${title}</p>
                                                <footer class="blockquote-footer">${nickname}--${comment} <cite title="Source Title"></cite></footer>
                                            </blockquote>
                                         </div>`
                        $('#comment-list').append(temp_html)
                    }

                }
            });
        }
    </script>
  </head>
  <body>
    <!-- 상단바 -->
    <section class="topbar">
      <h1 class="topbar_title">프로젝트 이름</h1>
      <div class="topbar_category">
        <span>{{nickname}}</span>
        <button class="button is-danger" onclick="logout()">Log out</button>
        
      </div>
    </section>
    <section class="description">
      <!-- 왼쪽 크롤링값 -->
      <div class="description_left">
        <div class="description_left_map">
          <div id="cards-box">
            <div class="col">
             <!-- gym 목록이 나오는곳  -->
            </div>
          </div>
        </div>

        <!-- 코멘트박스 , 등록버튼 -->
        <div class="description_left_comment">
          <input id="comment" type="text" />
        </div>
      </div>

      <!-- 우측 리뷰박스 -->
      <div id="comment-list" class="description_right">
        
      </div>
    </section>
  </body>
</html>
